---
/**
 * 零依赖版 SocialLinks.astro
 * 用法：<SocialLinks links={about.links} align="center" size={24} gap={16} />
 */

type IconKey =
  | "github"
  | "researchgate"
  | "mail"
  | "outlook"
  | "linkedin"
  | "instagram"
  | "scholar";

interface LinkItem { href: string; label: string; icon?: IconKey; ariaLabel?: string; }
interface Props {
  links: LinkItem[];
  align?: "start" | "center" | "end";
  size?: number;
  gap?: number;
  color?: string;
  hoverColor?: string;
}

const {
  links = [],
  align = "center",
  size = 24,
  gap = 16,
  color = "var(--gray-12)",
  hoverColor = "seagreen",
} = Astro.props as Props;

// 根据 label 猜 icon（当 icon 未提供或写错时兜底）
function guessIcon(label: string): IconKey | undefined {
  const t = label.toLowerCase();
  if (t.includes("github")) return "github";
  if (t.includes("researchgate")) return "researchgate";
  if (t.includes("scholar")) return "scholar";
  if (t.includes("linkedin")) return "linkedin";
  if (t.includes("insta")) return "instagram";
  if (t.includes("outlook")) return "outlook";
  if (t.includes("mail") || t.includes("email")) return "mail";
  return undefined;
}

/** 内置 SVG path（currentColor 着色） */
const iconMap: Record<IconKey, string> = {
  github:
    `<path fill="currentColor" d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.03c-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.1-.75.09-.73.09-.73 1.22.09 1.86 1.25 1.86 1.25 1.08 1.84 2.83 1.31 3.52 1.01.11-.8.42-1.31.77-1.61-2.67-.31-5.47-1.34-5.47-5.95 0-1.31.47-2.38 1.24-3.22-.12-.31-.54-1.57.12-3.28 0 0 1.01-.32 3.31 1.23a11.5 11.5 0 0 1 6.02 0c2.31-1.55 3.31-1.23 3.31-1.23.66 1.71.24 2.97.12 3.28.77.84 1.24 1.91 1.24 3.22 0 4.62-2.8 5.63-5.48 5.94.43.37.82 1.1.82 2.23v3.3c0 .32.22.7.83.58A12 12 0 0 0 12 .5Z"/>`,
  researchgate:
    `<path fill="currentColor" d="M17.6 6.4a4.6 4.6 0 0 0-6.52-.14 4.7 4.7 0 0 0-.2 6.45l.07.09c.69.75 1.64 1.24 2.68 1.38 1.11.14 2.17-.1 3.03-.67l1.29 1.64c.19.24.16.59-.06.79-.22.2-.56.17-.75-.06l-1.28-1.62c-.99.57-2.21.8-3.52.64a5.93 5.93 0 0 1-3.46-1.69A6 6 0 0 1 6 8.95a6 6 0 0 1 10.53-3.77l.04.05c.2.25.16.61-.09.8a.56.56 0 0 1-.78-.07ZM10.8 9.6h5.2c.33 0 .6.27.6.6v3.2a.6.6 0 1 1-1.2 0V10.8h-4.6a.6.6 0 0 1 0-1.2Z"/>`,
  mail:
    `<path fill="currentColor" d="M3 5h18a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Zm0 2v.4l9 5.6 9-5.6V7H3Zm18 10V9.1l-8.46 5.26a2 2 0 0 1-2.08 0L2 9.1V17h19Z"/>`,
  outlook:
    `<path fill="currentColor" d="M3 7.5A2.5 2.5 0 0 1 5.5 5H14v14H5.5A2.5 2.5 0 0 1 3 16.5v-9ZM16 8h5a1 1 0 0 1 1 1v8.5A2.5 2.5 0 0 1 19.5 20H16V8Zm-5.75 3.25c-1.24 0-2.25 1.12-2.25 2.5s1.01 2.5 2.25 2.5S12.5 15.12 12.5 13.75s-1.01-2.5-2.25-2.5Zm0 1c.73 0 1.25.69 1.25 1.5s-.52 1.5-1.25 1.5S8.75 14.56 8.75 13.75s.52-1.5 1.25-1.5Z"/>`,
  linkedin:
    `<path fill="currentColor" d="M4.98 3.5C4.98 4.61 4.1 5.5 3 5.5S1.02 4.61 1.02 3.5C1.02 2.4 1.9 1.5 3 1.5s1.98.9 1.98 2ZM1.5 7h3V21h-3V7Zm7 0h2.86v1.91h.04c.4-.76 1.37-1.56 2.82-1.56 3.01 0 3.57 1.98 3.57 4.55V21h-3v-6.2c0-1.48-.03-3.39-2.07-3.39-2.07 0-2.39 1.62-2.39 3.29V21h-2.83V7Z"/>`,
  instagram:
    `<path fill="currentColor" d="M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10Zm0 8.2A3.2 3.2 0 1 1 12 8.8a3.2 3.2 0 0 1 0 6.4Zm6.4-8.58a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0ZM7.3 3h9.4A4.3 4.3 0 0 1 21 7.3v9.4A4.3 4.3 0 0 1 16.7 21H7.3A4.3 4.3 0 0 1 3 16.7V7.3A4.3 4.3 0 0 1 7.3 3Zm9.4 2H7.3A2.3 2.3 0 0 0 5 7.3v9.4A2.3 2.3 0 0 0 7.3 19h9.4A2.3 2.3 0 0 0 19 16.7V7.3A2.3 2.3 0 0 0 16.7 5Z"/>`,
  scholar:
    `<path fill="currentColor" d="M12 2 2 7l10 5 8-4v6h2V7L12 2Zm0 7L5 6.5 12 3l7 3.5L12 9Zm-6 6.5A6 6 0 1 0 18 21H6v-5.5Zm2 1.5v3h8a4 4 0 1 0-8 0Z"/>`,
};

function Icon({ name, size }: { name: IconKey; size: number }) {
  const svg = iconMap[name];
  return svg
    ? `<svg width="${size}" height="${size}" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">${svg}</svg>`
    : "";
}
---

{links.length > 0 && (
  <ul class="social-links"
      style={`--gap:${gap}px; --size:${size}px; --color:${color}; --hover:${hoverColor}; --align:${align};`}>
    {links.map((l) => {
      const guessed = guessIcon(l.label);
      const validIcon = (l.icon && (l.icon in iconMap)) ? l.icon : undefined;
      const name = (validIcon ?? guessed ?? "mail") as IconKey;

      const isMail = l.href.startsWith("mailto:");
      const rel = isMail ? "nofollow noopener" : "noopener noreferrer";
      const target = isMail ? "_self" : "_blank";

      return (
        <li>
          <a href={l.href} target={target} rel={rel} aria-label={l.ariaLabel ?? l.label} title={l.label}
             set:html={Icon({ name, size })}>
            <span class="sr-only">{l.label}</span>
          </a>
        </li>
      );
    })}
  </ul>
)}

<style>
  .social-links{
    display:flex; flex-wrap:wrap; gap:var(--gap,16px);
    justify-content: var(--_justify);
    margin:16px 0 0; padding:0; list-style:none; color: var(--color, #111);
  }
  .social-links{ --_justify: center; }
  .social-links[style*="--align:start"]{ --_justify: flex-start; }
  .social-links[style*="--align:center"]{ --_justify: center; }
  .social-links[style*="--align:end"]{ --_justify: flex-end; }

  .social-links a{
    display:inline-flex; line-height:0;
    transition: transform .12s ease, color .15s ease;
  }
  .social-links a:hover{
    color: var(--hover, seagreen);
    transform: translateY(-1px);
  }
  .social-links svg{ width: var(--size,24px); height: var(--size,24px); }

  .sr-only{
    position:absolute;width:1px;height:1px;padding:0;margin:-1px;
    overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
  }
</style>
