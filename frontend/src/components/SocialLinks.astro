---
/**
 * SocialLinks.astro（线条描边风格版）
 * 用法：<SocialLinks links={about.links} align="center" size={24} gap={16} />
 */

type IconKey =
  | "github"
  | "researchgate"
  | "mail"
  | "outlook"
  | "linkedin"
  | "instagram"
  | "scholar";

interface LinkItem {
  href: string;
  label: string;
  icon?: IconKey;
  ariaLabel?: string;
}

interface Props {
  links: LinkItem[];
  align?: "start" | "center" | "end";
  size?: number;
  gap?: number;
  color?: string;
  hoverColor?: string;
}

const {
  links = [],
  align = "center",
  size = 24,
  gap = 16,
  color = "var(--gray-12)",
  hoverColor = "seagreen",
} = Astro.props as Props;

// 根据 label 猜 icon
function guessIcon(label: string): IconKey | undefined {
  const t = label.toLowerCase();
  if (t.includes("github")) return "github";
  if (t.includes("researchgate")) return "researchgate";
  if (t.includes("scholar")) return "scholar";
  if (t.includes("linkedin")) return "linkedin";
  if (t.includes("insta")) return "instagram";
  if (t.includes("outlook")) return "outlook";
  if (t.includes("mail") || t.includes("email")) return "mail";
  return undefined;
}

/** 统一线条风格 iconMap */
const iconMap: Record<IconKey, string> = {
  github: `
    <path d="M15 22v-2.87a3.37 3.37 0 0 0-.94-2.6c3.14-.35 6.44-1.54 6.44-7a5.44 5.44 0 0 0-1.5-3.78a5.06 5.06 0 0 0-.09-3.77S17.91 1.6 15 3.48a13.38 13.38 0 0 0-6 0C6.09 1.6 5 1.98 5 1.98a5.06 5.06 0 0 0-.09 3.77A5.44 5.44 0 0 0 3.5 9.5c0 5.43 3.3 6.62 6.44 7A3.37 3.37 0 0 0 9 19.13V22" />
    <path d="M9 19c-4 1.5-4-2.5-6-3" />
  `,
  researchgate: `
    <circle cx="12" cy="12" r="9" />
    <path d="M9 8h4a3 3 0 0 1 0 6h-3v4" />
    <path d="M13 14l3 4" />
  `,
  mail: `
    <rect x="3" y="5" width="18" height="14" rx="2" />
    <path d="m3 7 9 6 9-6" />
  `,
  outlook: `
    <rect x="6" y="7" width="12" height="10" rx="2" />
    <path d="m6 9 6 4 6-4" />
    <rect x="2" y="9" width="3" height="8" rx="1" />
  `,
  linkedin: `
    <rect x="4" y="4" width="16" height="16" rx="2" />
    <path d="M8 11v5M8 8h.01M12 11v5M16 11a3 3 0 0 0-4 2.82" />
  `,
  instagram: `
    <rect x="3" y="3" width="18" height="18" rx="5" />
    <circle cx="12" cy="12" r="3.5" />
    <circle cx="17" cy="7" r="1" />
  `,
  scholar: `
    <path d="m12 4 9 5-9 5-9-5 9-5Z" />
    <path d="M7 12v4a5 5 0 0 0 10 0v-4" />
  `,
};

function Icon({ name, size }: { name: IconKey; size: number }) {
  const body = iconMap[name];
  return body
    ? `<svg width="${size}" height="${size}" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
          ${body}
       </svg>`
    : "";
}
---

{links.length > 0 && (
  <ul
    class="social-links"
    style={`--gap:${gap}px; --size:${size}px; --color:${color}; --hover:${hoverColor}; --align:${align};`}
  >
    {links.map((l) => {
      const guessed = guessIcon(l.label);
      const validIcon = l.icon && (l.icon in iconMap) ? l.icon : undefined;
      const name = (validIcon ?? guessed ?? "mail") as IconKey;

      const isMail = l.href.startsWith("mailto:");
      const rel = isMail ? "nofollow noopener" : "noopener noreferrer";
      const target = isMail ? "_self" : "_blank";

      return (
        <li>
          <a
            href={l.href}
            target={target}
            rel={rel}
            aria-label={l.ariaLabel ?? l.label}
            title={l.label}
          >
            <span class="icon" set:html={Icon({ name, size })} aria-hidden="true"></span>
            <span class="sr-only">{l.label}</span>
          </a>
        </li>
      );
    })}
  </ul>
)}

<style>
  .social-links {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap, 16px);
    justify-content: var(--_justify);
    margin: 16px 0 0;
    padding: 0;
    list-style: none;
    color: var(--color, #111);
  }
  .social-links {
    --_justify: center;
  }
  .social-links[style*="--align:start"] {
    --_justify: flex-start;
  }
  .social-links[style*="--align:center"] {
    --_justify: center;
  }
  .social-links[style*="--align:end"] {
    --_justify: flex-end;
  }

  .social-links a {
    display: inline-flex;
    line-height: 0;
    transition: transform 0.12s ease, color 0.15s ease;
  }
  .social-links a:hover {
    color: var(--hover, seagreen);
    transform: translateY(-1px);
  }
  .social-links svg {
    width: var(--size, 24px);
    height: var(--size, 24px);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>
